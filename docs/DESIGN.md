# アレルゲンチェック業務システム 要件定義〜設計書（MVP）

---

## 0. 本書の位置づけ

本書は、スモールラグジュアリーホテル（例：ふふ）における**食物アレルギー対応業務**を対象に、
**現場で実際に行われている人力アレルゲンチェック業務を忠実に写像**したうえで、
MVP（Minimum Viable Product）として実装すべき要件と設計方針を整理するものである。

本書は以下を目的とする。

* 現場業務の共通理解を作る
* MVPのスコープを明確にする
* デモシステム・プレゼンの叩き台とする

---

## 1. 業務背景と課題認識

### 1.1 業務背景

* 高級旅館・ホテルでは、料理の品質と安全性の両立が強く求められる
* 食材・献立は季節・仕入れにより頻繁に変わる
* アレルギー情報は個別性が高く、判断を誤ると重大事故につながる

### 1.2 現状の課題

* アレルゲン確認が属人化している（料理長依存）
* 調味料・加工品・出汁など「見えないアレルゲン」が漏れやすい
* 判断理由・確認履歴が残らない
* 当日の共有・最終確認が人に依存している

---

## 2. 現行（人力）業務フロー整理（As-Is）

### 2.1 人力アレルゲンチェックの標準フロー

1. 予約時・事前にアレルギー情報を受領
2. 内容を具体化（何がNGか、重症度、調味料・コンタミ）
3. 当日の献立（料理名一覧）を確認
4. 明らかにNGな料理を除外
5. 条件付きでNGになり得る料理を洗い出し
6. 調味料・加工品・出汁を重点チェック
7. 原材料表示・規格書を確認
8. 判断不能な場合は料理長・仕入先に確認
9. 代替・差し替え料理を決定
10. 当日提供内容を確定
11. 朝礼・直前で共有
12. 配膳・最終確認
13. 提供・説明

### 2.2 役割と担当（As-Is）

※ 施設により呼称は異なるが、以下の責務を想定する

* 予約/フロント: 予約時のアレルギー情報受付、原文記録、事前共有
* サービス/配膳: 当日の提供内容の最終確認、配膳時の指差し確認、提供時の説明
* 料理長/キッチン責任者: 判定の最終判断、代替案の承認、仕入先への問い合わせ
* 仕入/購買: 規格書・原材料表示の入手、食材/調味料情報の更新
* 現場全体: 朝礼・直前共有での最終合意

### 2.3 ステップ別の担当と必要データ（As-Is）

| ステップ                              | 主担当        | 共同/確認 | 必要データ                                     |
| ------------------------------------- | ------------- | --------- | ---------------------------------------------- |
| 1. 予約時・事前にアレルギー情報を受領 | 予約/フロント | サービス  | 顧客情報、入力原文、連絡先                     |
| 2. 内容を具体化                       | サービス      | 料理長    | 何がNG/OKか、重症度、調味料/出汁、コンタミ許容 |
| 3. 当日の献立を確認                   | 料理長        | サービス  | 当日の献立一覧、コース構成                     |
| 4. 明らかにNGな料理を除外             | 料理長        | サービス  | 料理名、主要食材、既知アレルゲン               |
| 5. 条件付きNGを洗い出し               | 料理長        | サービス  | 衣/つなぎ/デザート等の疑義ポイント             |
| 6. 調味料・加工品・出汁を重点チェック | 料理長        | 仕入/購買 | 調味料/加工品一覧、成分/規格書                 |
| 7. 原材料表示・規格書を確認           | 仕入/購買     | 料理長    | 原材料表示、規格書、更新日                     |
| 8. 判断不能時の確認                   | 料理長        | 仕入/購買 | 仕入先連絡先、照会履歴                         |
| 9. 代替・差し替え料理を決定           | 料理長        | サービス  | 代替候補、提供体験の整合                       |
| 10. 当日提供内容を確定                | 料理長        | サービス  | 最終メニュー、対応内容                         |
| 11. 朝礼・直前で共有                  | サービス      | 全体      | 当日一覧、注意点                               |
| 12. 配膳・最終確認                    | サービス      | 料理長    | 当日一覧、チェック欄                           |
| 13. 提供・説明                        | サービス      | 料理長    | 提供内容、説明文言                             |

### 2.4 人力業務の本質

* 判断は「自動計算」ではなく「思い出し・確認・除外」
* 不明なものは安全側に倒す（要確認・不使用）
* 代替は料理単位ではなくコース全体の体験で考える

---

## 3. 目標フロー（To-Be / MVP）

UIは一旦置き、**業務の流れと必要データ**に集中する。

### 3.1 目標フロー（骨子）

1. 食材・調味料の仕入れ情報を取り込む
2. アレルゲン情報を正規化してデータベース登録
3. レシピ作成時に食材・調味料を紐づける
4. 顧客アレルゲンとレシピを突合し、対応が必要な料理・食材・調味料を可視化
5. 判定結果（OK / 要確認 / NG）を確定し、確認対象を一覧化する

### 3.2 方針

* 判断は人が行う
* システムは**判断漏れ防止・理由の可視化・共有の補助**に徹する

### 3.3 役割と担当（To-Be / MVP）

* 予約/フロント: 顧客アレルギー情報の入力原文登録、初期正規化の確定
* サービス/配膳: （MVP外）当日運用で判定結果を参照
* 料理長/キッチン責任者: 判定の最終判断、要確認の解消
* 仕入/購買: 食材・調味料情報の登録/更新、規格書・ラベルの取り込み
* 管理者（任意）: 権限/辞書管理、監査ログ確認

### 3.4 ステップ別の担当と必要データ（To-Be / MVP）

| ステップ                          | 主担当    | 共同/確認       | 必要データ                         |
| --------------------------------- | --------- | --------------- | ---------------------------------- |
| 1. 仕入れ情報の取り込み           | 仕入/購買 | 料理長          | 規格書/ラベル/原材料リスト         |
| 2. アレルゲンDB登録               | 仕入/購買 | 料理長          | 正規化名、アレルゲン属性、更新日   |
| 3. レシピと食材/調味料の紐づけ    | 料理長    | 仕入/購買       | 料理、食材、調味料、共通仕込み     |
| 4. 顧客アレルゲンとの突合・可視化 | システム  | 料理長/サービス | 顧客アレルゲン、食材アレルゲン属性 |
| 5. 判定確定・要確認一覧の出力     | 料理長    | サービス        | 最終判定、理由、要確認項目         |

---

## 4. MVPのスコープ定義

### 4.1 MVPでやること

* 仕入れ情報の半自動取り込み（OCR/CSV）
* アレルゲン（28品目）ベースの突合
* 表記ゆれの正規化（辞書 + 候補提示 + 人手確定）
* 不明食材を自動で「要確認」に落とす
* 判断理由の明示（どの料理のどの食材がNGか）
* 判定結果一覧の作成（OK / 要確認 / NG）

### 4.2 MVPでやらないこと

* 完全なレシピ管理
* 栄養計算
* コンタミリスクの自動判定
* 完全自動OK/NG判断
* 代替・除去済みレシピの自動生成
* 当日提供一覧・配膳オペレーションの管理

### 4.3 MVPに含める運用・作業軽量化の前提

* 献立・食材・調味料は「全量手入力」ではなく、**テンプレ・複製・半自動取り込み**で登録する
* 判断は人が行い、システムは**候補提示と漏れ防止**に徹する

### 4.4 最小チェッカーのフォーカス

* 入力: 顧客のNGアレルゲン + 献立（料理→食材/調味料）
* 出力: 料理ごとの判定結果（OK / 要確認 / NG）と理由
* 出力: 要確認項目の一覧（追加確認が必要な食材・調味料）
* 調味料/出汁は「理由表示」まで（詳細深掘りは後回し）

---

## 5. データ構造（概念設計）

※ DB設計ではなく、概念レベルの構造

### 5.1 顧客（Guest Profile）

* アレルゲン（28品目・複数）
* 重症度（微量NG / 条件付き / 不明）
* コンタミ許容可否
* 自由記述
* 入力原文（正規化前の表記）

### 5.2 食材・調味料（Ingredient）

* 名称
* 種別（生鮮 / 加工品 / 調味料）
* アレルゲン属性（含む / 含まない / 不明）
* 名寄せキー（正規化名 / 同義語ID）
* 出典（規格書 / ラベル / 仕入先口頭 / 手入力）
* 有効期限（情報の鮮度管理）

### 5.3 共通仕込み（Sub-recipe）

* 基本出汁
* 醤油タレ
* 味噌ダレ
* 揚げ衣
* ドレッシング 等

### 5.4 料理（Menu / Dish）

* 料理名
* 主要食材
* 使用共通仕込み

### 5.5 判定結果（Assessment）

* 判定結果（OK / 要確認 / NG）
* 理由（該当アレルゲン + 原因要素）
* 対応内容（除去 / 代替 / 不可）
* 承認者

### 5.6 表記ゆれ・名寄せ（Normalization）

* 正規化辞書（例：たまご / 玉子 / 卵 → 卵）
* 同義語の候補提示（入力時サジェスト）
* 正規化に失敗した場合は**要確認**に落とす
* 正規化の確定は人が行い、履歴を残す

---

## 6. アレルゲン判定ルール（MVP）

### 6.1 判定ロジック

* 料理に含まれる食材・共通仕込みのアレルゲン集合を取得
* 顧客アレルゲンと突合

```
if 明確に含有 → NG
if 不明 → 要確認
if 含有なし → OK
```

* 顧客条件（微量NG等）によりNG/OKを調整

### 6.2 原則

* 自動OKは慎重に
* 不明は必ず止める

### 6.3 表記ゆれの扱い（運用）

* 受付時に「入力原文」を必ず保持
* 28品目に正規化できない語は**自由記述 + 要確認**として残す
* 現場で確認した結果を辞書に還元し、次回以降の自動化精度を上げる

### 6.4 代替・除去への接続（将来フェーズ）

* MVPでは、判定結果と理由を確定するところまでを対象とする
* 代替・除去の具体化（レシピ生成、当日提供一覧、配膳運用）は将来フェーズで扱う

---

## 7. 仕入れ・ラベル情報の取り込み（MVP）

### 7.1 目的

* アレルゲン判定に必要な食材/調味料情報を**仕入れ時点で正規化**しDB登録する
* 「不明」を減らし、要確認の発生を抑える

### 7.2 取り込み対象

* 規格書（PDF/紙）
* ラベル表示（写真/スキャン）
* 仕入先からの原材料リスト（CSV/Excel）

### 7.3 最小フロー

1. 仕入/購買が「原材料情報」を取り込み
2. OCR/CSV取り込みで項目抽出
3. 正規化（表記ゆれ/同義語）とアレルゲン付与
4. 差分レビュー（料理長確認）
5. 承認後にDB反映

### 7.4 登録時に必須のデータ

* 名称（正規化名 + 原文）
* 種別（生鮮/加工品/調味料）
* アレルゲン属性（含む/含まない/不明）
* 出典（規格書/ラベル/仕入先口頭）
* 有効期限/更新日

---

## 8. 具体例

### 8.1 卵アレルギー対応フロー

1. 卵アレルギー（微量NG）を登録
2. 玉子豆腐 → NG
3. 揚げ物 → 要確認（衣）
4. 衣に卵使用 → NG
5. NG理由を確定して判定一覧に反映

### 8.2 調味料アレルギー対応フロー

1. 醤油・味噌NGを登録
2. 全料理を調味料視点で再確認
3. 出汁・下味・加工品を確認
4. 不明要素を要確認として抽出
5. 判定一覧（OK/要確認/NG）を確定

---

## 9. まとめ

* 本MVPは「仕入れ情報の取り込み〜アレルゲン判定」までの半自動化が目的
* 人力業務を正確に写像することで、現場に受け入れられる
* 本設計をもとにデモ・プレゼン・PoCを実施可能

---

（以上）
